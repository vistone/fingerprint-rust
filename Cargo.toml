[package]
name = "fingerprint"
version = "1.0.0"
edition = "2021"
authors = ["fingerprint-rust"]
description = "一个独立的浏览器 TLS 指纹库，从 golang 版本迁移而来"
license = "BSD-3-Clause"
repository = "https://github.com/vistone/fingerprint-rust"
documentation = "https://docs.rs/fingerprint"
homepage = "https://github.com/vistone/fingerprint-rust"
keywords = ["tls", "fingerprint", "browser", "http2", "ja4", "grease"]
categories = ["network-programming", "web-programming"]

[dependencies]
rand = "0.8"
once_cell = "1.19"
sha2 = "0.10"
thiserror = "2.0"
log = "0.4"

# HTTP 客户端依赖 (可选)
rustls = { version = "0.21", optional = true, features = ["dangerous_configuration"] }
webpki-roots = { version = "0.25", optional = true }
native-tls = { version = "0.2", optional = true }
flate2 = { version = "1.0", optional = true }  # gzip/deflate 解压

# HTTP/2 支持
h2 = { version = "0.4", optional = true }
http = { version = "1.1", optional = true }
tokio = { version = "1.40", features = ["full"], optional = true }
tokio-rustls = { version = "0.24", optional = true }

# HTTP/3 支持 (使用兼容的版本组合)
quinn = { version = "0.10", optional = true }
h3 = { version = "0.0.4", optional = true }
h3-quinn = { version = "0.0.5", optional = true }
bytes = { version = "1.10", optional = true }

# 网络连接池
netconnpool = { git = "https://github.com/vistone/netconnpool-rust", tag = "v1.0.0", optional = true }

# 时间处理
chrono = { version = "0.4", optional = true }
httparse = "1.10.1"
hex = "0.4.3"
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
ring = "0.17.14"

[dev-dependencies]
criterion = { version = "0.5", features = ["html_reports"] }
reqwest = { version = "0.11", features = ["blocking", "json", "rustls-tls"], default-features = false }
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
chrono = "0.4"  # 用于生成时间戳报告
netconnpool = { git = "https://github.com/vistone/netconnpool-rust", tag = "v1.0.0" }

[features]
default = ["rustls-tls", "compression", "http2"]
rustls-tls = ["rustls", "webpki-roots"]
native-tls-impl = ["native-tls"]
compression = ["flate2"]  # 启用压缩支持
http2 = ["h2", "http", "tokio", "tokio-rustls", "rustls", "webpki-roots"]  # HTTP/2 支持
http3 = ["quinn", "h3", "h3-quinn", "tokio", "rustls", "webpki-roots", "bytes"]  # HTTP/3 支持
async = ["tokio"]  # 异步运行时
connection-pool = ["netconnpool"]  # 连接池支持
reporter = ["chrono"]  # 报告生成器

# 方案A：配合你 fork/backport 的 rustls（0.21.x）开启 ClientHello 扩展顺序定制。
# 注意：上游 rustls 0.21 并没有这些 API；必须通过 [patch.crates-io] 指向你的 fork 才能编译。
rustls-client-hello-customizer = ["rustls-tls"]

# 接入你 fork 的 rustls（方案A）：
# - 你在 `vistone/rustls` 上把 PR#1 的改动 backport 到 rustls 0.21.x（与本项目依赖链一致）
# - 这里用 backport 的 commit SHA 覆盖 crates.io 的 rustls

[patch.crates-io]
rustls = { git = "https://github.com/vistone/rustls", rev = "c9390f5923a4adf6bb5a0a828e313e6f5d73e037" }
